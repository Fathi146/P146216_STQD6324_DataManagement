{"paragraphs":[{"text":"//function to parse the data file into HDFS\n\nhadoop fs -put ml-100k/u.user /user/maria_dev/ml-100k/u.user\nhadoop fs -put ml-100k/u.data /user/maria_dev/ml-100k/u.data\nhadoop fs -put ml-100k/u.item /user/maria_dev/ml-100k/u.item\n","user":"anonymous","dateUpdated":"2025-07-23T14:04:01+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753279359673_-1028349350","id":"20250723-140239_675031605","dateCreated":"2025-07-23T14:02:39+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:2410"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753277798921_826258009","id":"20250723-133638_1492443408","dateCreated":"2025-07-23T13:36:38+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:225","text":"%spark\r\n\r\nimport org.apache.spark.sql.SparkSession\r\nimport org.apache.spark.sql.functions._\r\n\r\nval spark = SparkSession.builder().appName(\"MovieLens100k\").getOrCreate()\r\nspark.sparkContext.setLogLevel(\"WARN\")\r\n","dateUpdated":"2025-07-23T13:40:04+0000","dateFinished":"2025-07-23T13:40:07+0000","dateStarted":"2025-07-23T13:40:04+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.spark.sql.SparkSession\nimport org.apache.spark.sql.functions._\nspark: org.apache.spark.sql.SparkSession = org.apache.spark.sql.SparkSession@24409154\n"}]}},{"text":"%spark\n\nval userRDD = spark.sparkContext.textFile(\"hdfs:///user/maria_dev/ml-100k/u.user\")\n\nval usersDF = userRDD.map(_.split(\"\\\\|\")).map(f =>\n  (f(0).toInt, f(1).toInt, f(2), f(3), f(4))\n).toDF(\"user_id\", \"age\", \"gender\", \"occupation\", \"zip\")\n\nusersDF.createOrReplaceTempView(\"users\")\n\nusersDF.show(5)\n","user":"anonymous","dateUpdated":"2025-07-23T13:40:45+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753277877554_881215805","id":"20250723-133757_726750817","dateCreated":"2025-07-23T13:37:57+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:336","dateFinished":"2025-07-23T13:41:06+0000","dateStarted":"2025-07-23T13:40:46+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"userRDD: org.apache.spark.rdd.RDD[String] = hdfs:///user/maria_dev/ml-100k/u.user MapPartitionsRDD[9] at textFile at <console>:33\nusersDF: org.apache.spark.sql.DataFrame = [user_id: int, age: int ... 3 more fields]\n+-------+---+------+----------+-----+\n|user_id|age|gender|occupation|  zip|\n+-------+---+------+----------+-----+\n|      1| 24|     M|technician|85711|\n|      2| 53|     F|     other|94043|\n|      3| 23|     M|    writer|32067|\n|      4| 24|     M|technician|43537|\n|      5| 33|     F|     other|15213|\n+-------+---+------+----------+-----+\nonly showing top 5 rows\n\n"}]}},{"text":"%spark\r\n\r\nval ratingsRDD = spark.sparkContext.textFile(\"hdfs:///user/maria_dev/ml-100k/u.data\")\r\n\r\nval ratingsDF = ratingsRDD.map(_.split(\"\\t\")).map(f =>\r\n  (f(0).toInt, f(1).toInt, f(2).toInt)\r\n).toDF(\"user_id\", \"movie_id\", \"rating\")\r\n\r\nratingsDF.createOrReplaceTempView(\"ratings\")\r\n\r\nratingsDF.show(5)\r\n","user":"anonymous","dateUpdated":"2025-07-23T13:41:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753277982978_2147009038","id":"20250723-133942_162414873","dateCreated":"2025-07-23T13:39:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:607","dateFinished":"2025-07-23T13:41:23+0000","dateStarted":"2025-07-23T13:41:20+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"ratingsRDD: org.apache.spark.rdd.RDD[String] = hdfs:///user/maria_dev/ml-100k/u.data MapPartitionsRDD[17] at textFile at <console>:33\nratingsDF: org.apache.spark.sql.DataFrame = [user_id: int, movie_id: int ... 1 more field]\n+-------+--------+------+\n|user_id|movie_id|rating|\n+-------+--------+------+\n|    196|     242|     3|\n|    186|     302|     3|\n|     22|     377|     1|\n|    244|      51|     2|\n|    166|     346|     1|\n+-------+--------+------+\nonly showing top 5 rows\n\n"}]}},{"text":"%spark\r\n\r\nval moviesRDD = spark.sparkContext.textFile(\"hdfs:///user/maria_dev/ml-100k/u.item\")\r\n\r\nval moviesDF = moviesRDD.map(_.split(\"\\\\|\")).map(f =>\r\n  (f(0).toInt, f(1))\r\n).toDF(\"movie_id\", \"title\")\r\n\r\nmoviesDF.createOrReplaceTempView(\"movies\")\r\n\r\nmoviesDF.show(5)\r\n","user":"anonymous","dateUpdated":"2025-07-23T13:41:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753277982674_798848892","id":"20250723-133942_1832003627","dateCreated":"2025-07-23T13:39:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:551","dateFinished":"2025-07-23T13:41:48+0000","dateStarted":"2025-07-23T13:41:46+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"moviesRDD: org.apache.spark.rdd.RDD[String] = hdfs:///user/maria_dev/ml-100k/u.item MapPartitionsRDD[25] at textFile at <console>:33\nmoviesDF: org.apache.spark.sql.DataFrame = [movie_id: int, title: string]\n+--------+-----------------+\n|movie_id|            title|\n+--------+-----------------+\n|       1| Toy Story (1995)|\n|       2| GoldenEye (1995)|\n|       3|Four Rooms (1995)|\n|       4|Get Shorty (1995)|\n|       5|   Copycat (1995)|\n+--------+-----------------+\nonly showing top 5 rows\n\n"}]}},{"text":"%sql\r\n\r\n--Calculate the average rating for each movie\r\n\r\nSELECT movie_id, ROUND(AVG(rating),2) AS avg_rating\r\nFROM ratings\r\nGROUP BY movie_id\r\nORDER BY movie_id\r\nLIMIT 10","user":"anonymous","dateUpdated":"2025-07-23T13:50:54+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":364,"optionOpen":false}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753277982418_700353173","id":"20250723-133942_1815265944","dateCreated":"2025-07-23T13:39:42+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:495","dateFinished":"2025-07-23T13:50:57+0000","dateStarted":"2025-07-23T13:50:54+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"movie_id\tavg_rating\n1\t3.88\n2\t3.21\n3\t3.03\n4\t3.55\n5\t3.3\n6\t3.58\n7\t3.8\n8\t4.0\n9\t3.9\n10\t3.83\n"}]}},{"text":"%sql\n\n--Identify the top ten movies with the highest average ratings\n\nSELECT m.title, ROUND(AVG(r.rating),2) AS avg_rating\nFROM ratings r\nJOIN movies m ON r.movie_id = m.movie_id\nGROUP BY m.title\nORDER BY avg_rating DESC\nLIMIT 10\n\n","user":"anonymous","dateUpdated":"2025-07-23T13:50:37+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":408,"optionOpen":false}}},"editorSetting":{"language":"sql","editOnDblClick":false},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753277981751_858484971","id":"20250723-133941_186201019","dateCreated":"2025-07-23T13:39:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:439","dateFinished":"2025-07-23T13:50:32+0000","dateStarted":"2025-07-23T13:50:24+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"title\tavg_rating\nSanta with Muscles (1996)\t5.0\nEntertaining Angels: The Dorothy Day Story (1996)\t5.0\nThey Made Me a Criminal (1939)\t5.0\nStar Kid (1997)\t5.0\nGreat Day in Harlem, A (1994)\t5.0\nSaint of Fort Washington, The (1993)\t5.0\nSomeone Else's America (1995)\t5.0\nMarlene Dietrich: Shadow and Light (1996) \t5.0\nAiqing wansui (1994)\t5.0\nPrefontaine (1997)\t5.0\n"}]}},{"text":"%sql\r\n\r\n--Find the user who have rated at least 50 movies and identify their favourite movie\r\n\r\nWITH active_users AS (\r\n  SELECT user_id, COUNT(*) AS num_ratings\r\n  FROM ratings\r\n  GROUP BY user_id\r\n  HAVING num_ratings >= 50\r\n),\r\nactive_users_top10 AS (\r\n  SELECT user_id\r\n  FROM active_users\r\n  ORDER BY num_ratings DESC\r\n  LIMIT 10\r\n),\r\nuser_fav_movies AS (\r\n  SELECT r.user_id, r.movie_id, r.rating\r\n  FROM ratings r\r\n  JOIN active_users_top10 a ON r.user_id = a.user_id\r\n  WHERE r.rating = 5\r\n),\r\nuser_fav_movies_with_title AS (\r\n  SELECT ufm.user_id, m.title\r\n  FROM user_fav_movies ufm\r\n  JOIN movies m ON ufm.movie_id = m.movie_id\r\n),\r\nranked_movies AS (\r\n  SELECT *,\r\n         ROW_NUMBER() OVER (PARTITION BY user_id ORDER BY title) AS rn\r\n  FROM user_fav_movies_with_title\r\n)\r\nSELECT user_id, title AS favourite_movie\r\nFROM ranked_movies\r\nWHERE rn = 1\r\nORDER BY user_id\r\n","user":"anonymous","dateUpdated":"2025-07-23T14:02:24+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":378,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753279001452_2129747888","id":"20250723-135641_216291389","dateCreated":"2025-07-23T13:56:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1958","dateFinished":"2025-07-23T14:01:44+0000","dateStarted":"2025-07-23T14:01:34+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"user_id\tfavourite_movie\n13\t2001: A Space Odyssey (1968)\n234\t12 Angry Men (1957)\n276\t2001: A Space Odyssey (1968)\n303\tAce Ventura: Pet Detective (1994)\n393\tApt Pupil (1998)\n405\t2001: A Space Odyssey (1968)\n416\t12 Angry Men (1957)\n450\tAge of Innocence, The (1993)\n537\t2001: A Space Odyssey (1968)\n655\tAngel Baby (1995)\n"}]}},{"text":"%sql\n\n--Find all the users who are less than 20 years old\n\nSELECT *\nFROM users\nWHERE age < 20\nLIMIT 10\n\n","user":"anonymous","dateUpdated":"2025-07-23T13:52:28+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":374,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753278699990_1232840718","id":"20250723-135139_370971462","dateCreated":"2025-07-23T13:51:39+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1638","dateFinished":"2025-07-23T13:52:24+0000","dateStarted":"2025-07-23T13:52:24+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"user_id\tage\tgender\toccupation\tzip\n30\t7\tM\tstudent\t55436\n36\t19\tF\tstudent\t93117\n52\t18\tF\tstudent\t55105\n57\t16\tM\tnone\t84010\n67\t17\tM\tstudent\t60402\n68\t19\tM\tstudent\t22904\n101\t15\tM\tstudent\t05146\n110\t19\tM\tstudent\t77840\n142\t13\tM\tother\t48118\n179\t15\tM\tentertainment\t20755\n"}]}},{"text":"%sql\n\n--Find all the users whose occupation is scientist and whose age is between 30 and 40 years old\n\nSELECT *\nFROM users\nWHERE occupation = 'scientist' AND age BETWEEN 30 AND 40\nLIMIT 10","user":"anonymous","dateUpdated":"2025-07-23T13:53:50+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":404,"optionOpen":false}}},"editorSetting":{"language":"sql"},"editorMode":"ace/mode/sql"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753278775028_1118493673","id":"20250723-135255_449051495","dateCreated":"2025-07-23T13:52:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1784","dateFinished":"2025-07-23T13:53:31+0000","dateStarted":"2025-07-23T13:53:31+0000","results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"user_id\tage\tgender\toccupation\tzip\n40\t38\tM\tscientist\t27514\n71\t39\tM\tscientist\t98034\n74\t39\tM\tscientist\tT8H1N\n107\t39\tM\tscientist\t60466\n183\t33\tM\tscientist\t27708\n272\t33\tM\tscientist\t53706\n309\t40\tM\tscientist\t70802\n337\t37\tM\tscientist\t10522\n430\t38\tM\tscientist\t98199\n538\t31\tM\tscientist\t21010\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1753278517562_-1191690320","id":"20250723-134837_894679195","dateCreated":"2025-07-23T13:48:37+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1121"}],"name":"STQD6324_Assignment3","id":"2M3FR521D","angularObjects":{"2CHS8UYQQ:shared_process":[],"2C8A4SZ9T_livy2:shared_process":[],"2CK8A9MEG:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2CKAY1A8Y:shared_process":[],"2CKEKWY8Z:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}